% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/historical_data.R
\name{historical_data}
\alias{historical_data}
\title{Fetch historical market data from Interactive Brokers}
\usage{
historical_data(conn, equity, barSize, duration, ...)
}
\arguments{
\item{conn}{An object of class \code{twsconn}, as returned by \code{IBrokers::twsConnect()} or your own \code{conn()} wrapper.}

\item{equity}{A Tws contract object (e.g. created by \code{IBrokers::twsSTK()}, \code{IBrokers::twsFuture()}, etc.). Must include a valid \code{exchange} and, for SMART routing, a \code{primary} exchange.}

\item{barSize}{Character. Size of each bar, e.g. \code{"1 min"}, \code{"5 mins"}, \code{"1 day"}.}

\item{duration}{Character. Look-back period, e.g. \code{"1 D"} (one trading day), \code{"1 W"}, \code{"1 M"}, \code{"1 Y"}.}

\item{...}{Additional arguments passed on to \code{IBrokers::reqHistoricalData()}, such as:
\describe{
  \item{\code{endDateTime}}{Character "YYYYMMDD HH:MM:SS", end of the period}
  \item{\code{whatToShow}}{Character, one of \code{"TRADES"}, \code{"MIDPOINT"}, \code{"BID"}, \code{"ASK"}, etc.}
  \item{\code{useRTH}}{Integer 1 (regular hours) or 0 (all hours)}
  \item{\code{formatDate}}{Integer 1 (R Date) or 2 (Unix timestamp)}
}}
}
\value{
A \code{data.table} with one row per bar. Typical columns are:

Wrapper around \code{IBrokers::reqHistoricalData()} to retrieve historical bars as a \code{data.table}.
Must be connected to TWS or IB-Gateway when calling this function.

A \code{data.table} with one row per bar. Typical columns are:
  \describe{
    \item{\code{date}}{POSIXct or Date, depending on \code{formatDate}}
    \item{\code{open}}{Opening price}
    \item{\code{high}}{Highest price}
    \item{\code{low}}{Lowest price}
    \item{\code{close}}{Closing price}
    \item{\code{volume}}{Volume traded}
    \item{\code{average}}{Average price}
    \item{\code{barCount}}{Number of trades in the bar}
  }
}
\description{
Wrapper around \code{IBrokers::reqHistoricalData()} to retrieve historical bars as a \code{data.table}.
Must be connected to TWS or IB-Gateway when calling this function.
}
\examples{
\dontrun{
# 1. Connect to IB
conn <- IBrokers::twsConnect(clientId = 1, host = "localhost", port = 4002)

# 2. Define AAPL contract on SMART/NASDAQ
stk <- IBrokers::twsSTK("AAPL", exch = "SMART", primary = "NASDAQ", currency = "USD")

# 3. Fetch last day’s 5-min bars
dt <- historical_data(
  conn       = conn,
  equity     = stk,
  barSize    = "5 mins",
  duration   = "1 D",
  whatToShow = "TRADES",
  useRTH     = 1,
  formatDate = 1
)
head(dt)

# 4. Disconnect
IBrokers::twsDisconnect(conn)
}

\dontrun{
# 1. Connect to IB
conn <- IBrokers::twsConnect(clientId = 1, host = "localhost", port = 4002)

# 2. Define AAPL contract on SMART/NASDAQ
stk <- IBrokers::twsSTK("AAPL", exch = "SMART", primary = "NASDAQ", currency = "USD")

# 3. Fetch last day’s 5-min bars
dt <- historical_data(
  conn       = conn,
  equity     = stk,
  barSize    = "5 mins",
  duration   = "1 D",
  whatToShow = "TRADES",
  useRTH     = 1,
  formatDate = 1
)
head(dt)

# 4. Disconnect
IBrokers::twsDisconnect(conn)
}

}
\seealso{
\code{\link[IBrokers]{reqHistoricalData}}, \code{\link[IBrokers]{twsSTK}}
}
